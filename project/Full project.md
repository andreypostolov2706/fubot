# FuBot ‚Äî –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

> –ú–æ–¥—É–ª—å–Ω—ã–π Telegram-–±–æ—Ç —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –≤–∞–ª—é—Ç–æ–π GTON, –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –∏ —Å–∏—Å—Ç–µ–º–æ–π –ø–æ–¥–∫–ª—é—á–∞–µ–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#1-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤](#2-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ñ–∞–π–ª–æ–≤)
3. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#3-–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
4. [Telegram –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞](#4-telegram-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
5. [–°–∏—Å—Ç–µ–º–∞ GTON](#5-—Å–∏—Å—Ç–µ–º–∞-gton)
6. [–ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞](#6-–ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è-–ø—Ä–æ–≥—Ä–∞–º–º–∞)
7. [–°–∏—Å—Ç–µ–º–∞ —Å–µ—Ä–≤–∏—Å–æ–≤](#7-—Å–∏—Å—Ç–µ–º–∞-—Å–µ—Ä–≤–∏—Å–æ–≤)
8. [–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å](#8-–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)
9. [–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è](#9-–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è)
10. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#10-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
11. [–°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#11-—Å—Ç–∞—Ç—É—Å-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)

---

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         –Ø–î–†–û (core/)                        ‚îÇ
‚îÇ  –ù–µ–∏–∑–º–µ–Ω—è–µ–º–∞—è —á–∞—Å—Ç—å: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –±–∞–ª–∞–Ω—Å, –ø–∞—Ä—Ç–Ω—ë—Ä–∫–∞       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                      –°–ï–†–í–ò–°–´ (services/)                    ‚îÇ
‚îÇ  –ü–æ–¥–∫–ª—é—á–∞–µ–º—ã–µ –º–æ–¥—É–ª–∏ —Å–æ —Å–≤–æ–µ–π –ë–î –∏ –ª–æ–≥–∏–∫–æ–π                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è |
|-----------|------------|--------|
| –Ø–∑—ã–∫ | Python | 3.11+ |
| Telegram | python-telegram-bot | 21.0.1 |
| ORM | SQLAlchemy | 2.0 |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | SQLite (aiosqlite) | async |
| –í–∞–ª–∏–¥–∞—Ü–∏—è | Pydantic | 2.5 |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | Loguru | - |

---

## 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
FuBot/
‚îú‚îÄ‚îÄ core/                           # –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ main.py                     # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.py                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ database/                   # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ connection.py           # DatabaseManager, get_db()
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py                 # Base model
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models/                 # 19 –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ user.py             # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ wallet.py           # –ö–æ—à–µ–ª—å–∫–∏
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ transaction.py      # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ partner.py          # –ü–∞—Ä—Ç–Ω—ë—Ä—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ referral.py         # –†–µ—Ñ–µ—Ä–∞–ª—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ payout.py           # –í—ã–≤–æ–¥—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ commission.py       # –ö–æ–º–∏—Å—Å–∏–∏
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ promocode.py        # –ü—Ä–æ–º–æ–∫–æ–¥—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ daily_bonus.py      # –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ broadcast.py        # –†–∞—Å—Å—ã–ª–∫–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ moderation.py       # –ú–æ–¥–µ—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ setting.py          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ service.py          # –°–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ subscription.py     # –ü–æ–¥–ø–∏—Å–∫–∏
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ payment.py          # –ü–ª–∞—Ç–µ–∂–∏
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ notification.py     # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ event.py            # –°–æ–±—ã—Ç–∏—è
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ exchange_rate.py    # –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ platform/telegram/          # Telegram –∞–¥–∞–ø—Ç–µ—Ä
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot.py                  # TelegramBot class
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ setup.py                # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ router.py               # Callback router
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils.py                # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/               # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py            # /start, main_menu
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ messages.py         # –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ topup.py            # –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ partner.py          # –ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ daily_bonus.py      # –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ promocode.py        # –ü—Ä–æ–º–æ–∫–æ–¥—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ help.py             # –ü–æ–º–æ—â—å
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ service.py          # –°–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/                  # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py             # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py            # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stats.py            # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ partners.py         # –ü–∞—Ä—Ç–Ω—ë—Ä—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ promocodes.py       # –ü—Ä–æ–º–æ–∫–æ–¥—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ broadcast.py        # –†–∞—Å—Å—ã–ª–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ moderation.py       # –ú–æ–¥–µ—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services.py         # –°–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ languages.py        # –Ø–∑—ã–∫–∏
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ keyboards/              # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ main_menu.py        # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ plugins/                    # –°–∏—Å—Ç–µ–º–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base_service.py         # BaseService, Response, MenuItem
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core_api.py             # CoreAPI –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ registry.py             # ServiceRegistry
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ payments/                   # –ü–ª–∞—Ç–µ–∂–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ constants.py            # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ converter.py            # GTON –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rates.py                # –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ base.py                 # –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ payout/                     # –í—ã–≤–æ–¥—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ service.py              # PayoutService
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ referral/                   # –†–µ—Ñ–µ—Ä–∞–ª—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ commission.py           # ReferralCommissionService
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ locales/                    # –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py             # t() —Ñ—É–Ω–∫—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ru.py                   # –†—É—Å—Å–∫–∏–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ en.py                   # English
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ tasks/                      # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
‚îÇ       ‚îî‚îÄ‚îÄ triggers.py             # –¢—Ä–∏–≥–≥–µ—Ä—ã —Ä–∞—Å—Å—ã–ª–æ–∫
‚îÇ
‚îú‚îÄ‚îÄ services/                       # –ü–æ–¥–∫–ª—é—á–∞–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îî‚îÄ‚îÄ (–ø—É—Å—Ç–æ ‚Äî –¥–ª—è –±—É–¥—É—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤)
‚îÇ
‚îú‚îÄ‚îÄ tests/                          # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_full_core.py           # –¢–µ—Å—Ç —è–¥—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ test_telegram_platform.py   # –¢–µ—Å—Ç Telegram
‚îÇ   ‚îî‚îÄ‚îÄ test_core_integration.py    # –ê—É–¥–∏—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ project/                        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ INDEX.md                    # –ò–Ω–¥–µ–∫—Å –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ Full project.md             # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îÇ
‚îú‚îÄ‚îÄ CHANGELOG.md                    # –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ TODO_GTON.md                    # –°—Ç–∞—Ç—É—Å GTON –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ requirements.txt                # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ .env                            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

---

## 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–¥–µ–ª–∏ (19 —Ç–∞–±–ª–∏—Ü)

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∫–æ—à–µ–ª—å–∫–∏

| –ú–æ–¥–µ–ª—å | –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|----------|
| `User` | users | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Telegram |
| `Wallet` | wallets | –ö–æ—à–µ–ª—å–∫–∏ (main/bonus) |
| `Transaction` | transactions | –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π |

```python
# User
class User(Base):
    telegram_id: int           # Telegram ID
    telegram_username: str     # @username
    first_name: str
    language: str              # ru/en
    role: str                  # user/admin
    referral_code: str         # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥
    is_blocked: bool
    
# Wallet
class Wallet(Base):
    user_id: int
    wallet_type: str           # main/bonus
    balance: Decimal(18,6)     # GTON
    
# Transaction
class Transaction(Base):
    user_id: int
    wallet_id: int
    type: str                  # credit/debit
    amount: Decimal(18,6)      # GTON
    direction: str
    balance_before: Decimal
    balance_after: Decimal
```

#### –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

| –ú–æ–¥–µ–ª—å | –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|----------|
| `Partner` | partners | –ü–∞—Ä—Ç–Ω—ë—Ä—ã |
| `Referral` | referrals | –°–≤—è–∑–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ |
| `Payout` | payouts | –ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥ |
| `Commission` | commissions | –ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–∏—Å—Å–∏–π |

```python
# Partner
class Partner(Base):
    user_id: int
    referral_code: str         # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –ø–∞—Ä—Ç–Ω—ë—Ä–∞
    status: str                # pending/active/blocked
    level1_percent: int        # –ö–æ–º–∏—Å—Å–∏—è 1 —É—Ä–æ–≤–Ω—è (%)
    balance: Decimal(18,6)     # –ë–∞–ª–∞–Ω—Å GTON
    frozen_balance: Decimal    # –ó–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞
    total_earned: Decimal
    total_withdrawn: Decimal
    total_referrals: int
    
    @property
    def available_balance(self):
        return self.balance - self.frozen_balance

# Payout
class Payout(Base):
    partner_id: int
    amount_gton: Decimal(18,6)
    fee_gton: Decimal
    amount_fiat: Decimal(12,2)
    currency: str              # RUB
    gton_rate: Decimal         # –ö—É—Ä—Å –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞—è–≤–∫–∏
    method: str                # card/sbp
    details: JSON              # {"card": "4276..."}
    status: str                # pending/approved/rejected
```

#### –ë–æ–Ω—É—Å—ã –∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã

| –ú–æ–¥–µ–ª—å | –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|----------|
| `DailyBonus` | daily_bonuses | –°—Ç–∞—Ç—É—Å –±–æ–Ω—É—Å–∞ |
| `DailyBonusHistory` | daily_bonus_history | –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ª—É—á–µ–Ω–∏–π |
| `PromoCode` | promocodes | –ü—Ä–æ–º–æ–∫–æ–¥—ã |
| `PromoCodeActivation` | promocode_activations | –ê–∫—Ç–∏–≤–∞—Ü–∏–∏ |

```python
# DailyBonus rewards (7 days)
DEFAULT_REWARDS = [0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 5.0]  # GTON

# PromoCode
class PromoCode(Base):
    code: str
    reward_type: str           # gton/subscription
    reward_value: Decimal
    max_activations: int
    current_activations: int
    is_active: bool
```

#### –†–∞—Å—Å—ã–ª–∫–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã

| –ú–æ–¥–µ–ª—å | –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|----------|
| `Broadcast` | broadcasts | –†–∞—Å—Å—ã–ª–∫–∏ |
| `BroadcastTrigger` | broadcast_triggers | –ê–≤—Ç–æ—Ç—Ä–∏–≥–≥–µ—Ä—ã |

```python
# BroadcastTrigger types
trigger_types = [
    "registration",      # –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    "first_deposit",     # –ü–µ—Ä–≤–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
    "inactivity_3d",     # –ù–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å 3 –¥–Ω—è
    "inactivity_7d",     # –ù–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å 7 –¥–Ω–µ–π
    "low_balance",       # –ù–∏–∑–∫–∏–π –±–∞–ª–∞–Ω—Å
]
```

#### –ú–æ–¥–µ—Ä–∞—Ü–∏—è

| –ú–æ–¥–µ–ª—å | –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|----------|
| `UserWarning` | user_warnings | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è |
| `UserBan` | user_bans | –ë–∞–Ω—ã |
| `ModerationLog` | moderation_log | –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π |

#### –°–µ—Ä–≤–∏—Å—ã

| –ú–æ–¥–µ–ª—å | –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|----------|
| `Service` | services | –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã |
| `UserService` | user_services | FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è |
| `Subscription` | subscriptions | –ü–æ–¥–ø–∏—Å–∫–∏ |

#### –ü—Ä–æ—á–µ–µ

| –ú–æ–¥–µ–ª—å | –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|----------|
| `Setting` | settings | –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| `Event` | events | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π |
| `ExchangeRate` | exchange_rates | –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç |
| `PaymentProvider` | payment_providers | –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã |
| `Payment` | payments | –ü–ª–∞—Ç–µ–∂–∏ |

---

## 4. Telegram –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–Ω—é

```
/start
  ‚îÇ
  ‚îî‚îÄ‚îÄ Main Menu
      ‚îÇ
      ‚îú‚îÄ‚îÄ üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å [daily_bonus]
      ‚îÇ     ‚îî‚îÄ‚îÄ –ü–æ–ª—É—á–∏—Ç—å [daily_bonus:claim]
      ‚îÇ
      ‚îú‚îÄ‚îÄ üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å [top_up]
      ‚îÇ     ‚îú‚îÄ‚îÄ 100 ‚ÇΩ [top_up:100]
      ‚îÇ     ‚îú‚îÄ‚îÄ 500 ‚ÇΩ [top_up:500]
      ‚îÇ     ‚îî‚îÄ‚îÄ 1000 ‚ÇΩ [top_up:1000]
      ‚îÇ
      ‚îú‚îÄ‚îÄ üéü –ü—Ä–æ–º–æ–∫–æ–¥ [promocode]
      ‚îÇ     ‚îî‚îÄ‚îÄ –û—Ç–º–µ–Ω–∞ [promocode:cancel]
      ‚îÇ
      ‚îú‚îÄ‚îÄ üë• –ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞ [partner]
      ‚îÇ     ‚îÇ
      ‚îÇ     ‚îú‚îÄ‚îÄ (–û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
      ‚îÇ     ‚îÇ     ‚îú‚îÄ‚îÄ –ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã [partner:referrals]
      ‚îÇ     ‚îÇ     ‚îî‚îÄ‚îÄ –°—Ç–∞—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º [partner:apply]
      ‚îÇ     ‚îÇ
      ‚îÇ     ‚îî‚îÄ‚îÄ (–ü–∞—Ä—Ç–Ω—ë—Ä)
      ‚îÇ           ‚îú‚îÄ‚îÄ –ö–∞–±–∏–Ω–µ—Ç [partner:cabinet]
      ‚îÇ           ‚îú‚îÄ‚îÄ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ [partner:stats]
      ‚îÇ           ‚îî‚îÄ‚îÄ –í—ã–≤–æ–¥ [partner:payout]
      ‚îÇ                 ‚îú‚îÄ‚îÄ –ö–∞—Ä—Ç–∞ [partner:payout:card]
      ‚îÇ                 ‚îú‚îÄ‚îÄ –°–ë–ü [partner:payout:sbp]
      ‚îÇ                 ‚îî‚îÄ‚îÄ –ò—Å—Ç–æ—Ä–∏—è [partner:payout:history]
      ‚îÇ
      ‚îú‚îÄ‚îÄ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ [settings]
      ‚îÇ     ‚îú‚îÄ‚îÄ –Ø–∑—ã–∫ [settings:language]
      ‚îÇ     ‚îî‚îÄ‚îÄ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è [settings:notifications]
      ‚îÇ
      ‚îú‚îÄ‚îÄ ‚ùì –ü–æ–º–æ—â—å [help]
      ‚îÇ
      ‚îî‚îÄ‚îÄ üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å [admin] (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã)
            ‚îú‚îÄ‚îÄ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ [admin:stats]
            ‚îú‚îÄ‚îÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ [admin:users]
            ‚îú‚îÄ‚îÄ –ü–∞—Ä—Ç–Ω—ë—Ä—ã [admin:partners]
            ‚îú‚îÄ‚îÄ –ú–æ–¥–µ—Ä–∞—Ü–∏—è [admin:moderation]
            ‚îú‚îÄ‚îÄ –ü—Ä–æ–º–æ–∫–æ–¥—ã [admin:promocodes]
            ‚îú‚îÄ‚îÄ –°–µ—Ä–≤–∏—Å—ã [admin:services]
            ‚îú‚îÄ‚îÄ –†–∞—Å—Å—ã–ª–∫–∏ [admin:broadcast]
            ‚îú‚îÄ‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ [admin:settings]
            ‚îî‚îÄ‚îÄ –Ø–∑—ã–∫–∏ [admin:languages]
```

### Callback routing

```python
# router.py
async def callback_router(update, context):
    data = query.data
    
    if data == "main_menu":
        await main_menu_callback(...)
    elif data.startswith("settings"):
        await settings_callback(...)
    elif data.startswith("partner"):
        await partner_callback(...)
    elif data.startswith("admin"):
        await admin_callback(...)
    elif data.startswith("service:"):
        await service_callback(...)
```

### FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è

| –°–æ—Å—Ç–æ—è–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ |
|-----------|----------|------------|
| `promocode_input` | –í–≤–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞ | `handle_promocode_input()` |
| `partner_payout_card` | –í–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã | `handle_payout_input()` |
| `partner_payout_sbp` | –í–≤–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –°–ë–ü | `handle_payout_input()` |
| `admin_*` | –ê–¥–º–∏–Ω—Å–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è | `admin/*.py` |

---

## 5. –°–∏—Å—Ç–µ–º–∞ GTON

### –ß—Ç–æ —Ç–∞–∫–æ–µ GTON

**GTON** ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –≤–∞–ª—é—Ç–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 6 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π.

```python
# –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
balance: Decimal(18, 6)  # –ù–∞–ø—Ä–∏–º–µ—Ä: 123.456789 GTON

# –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
format_gton(Decimal("123.456789"))  # "123.46 GTON"
```

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è

```python
# GTON -> Fiat
gton_amount = Decimal("10")
rub_amount = await converter.convert_from_gton(gton_amount, "RUB")
# 10 GTON * 100 RUB/GTON = 1000 RUB

# Fiat -> GTON
result = await converter.convert_to_gton(Decimal("1000"), "RUB")
# 1000 RUB / 100 = 10 GTON
```

### –ö—É—Ä—Å—ã

```python
# –¶–µ–ø–æ—á–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
GTON -> TON -> RUB

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
GTON_TON_RATE = 1.53      # 1 GTON = 1.53 TON
TON_RUB_RATE = ~650       # –ò–∑ API (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)

# –ò—Ç–æ–≥–æ
1 GTON ‚âà 1.53 * 650 ‚âà 995 RUB
```

### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–∞–Ω—Å–æ–º

```python
# –ß–µ—Ä–µ–∑ CoreAPI (–¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤)
api = CoreAPI("my_service")

# –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å
balance = await api.get_balance(user_id)

# –°–ø–∏—Å–∞—Ç—å (—Å –∫–æ–º–∏—Å—Å–∏–µ–π —Ä–µ—Ñ–µ—Ä–µ—Ä—É)
result = await api.deduct_balance(
    user_id=user_id,
    amount=Decimal("10"),
    description="–ü–æ–∫—É–ø–∫–∞ —É—Å–ª—É–≥–∏"
)

# –ù–∞—á–∏—Å–ª–∏—Ç—å
result = await api.add_balance(
    user_id=user_id,
    amount=Decimal("5"),
    source="bonus"
)
```

---

## 6. –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

### –£—Ä–æ–≤–Ω–∏ –∫–æ–º–∏—Å—Å–∏–π

| –£—Ä–æ–≤–µ–Ω—å | –ö—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç | % –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|---------|--------------|----------------|
| 1 | –ü—Ä—è–º–æ–π —Ä–µ—Ñ–µ—Ä–µ—Ä | 10% |
| 2 | –ü–∞—Ä—Ç–Ω—ë—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å) | 10-30% |

### –ü—Ä–æ—Ü–µ—Å—Å

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ:
   https://t.me/bot?start=partner_ABC123
   
2. process_referral() —Å–æ–∑–¥–∞—ë—Ç —Å–≤—è–∑—å:
   Referral(referrer_id=partner.user_id, referred_id=new_user.id)
   
3. –ü—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞ —É —Ä–µ—Ñ–µ—Ä–∞–ª–∞:
   ReferralCommissionService.process_commission()
   ‚Üí –ù–∞—Ö–æ–¥–∏—Ç —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
   ‚Üí –ù–∞—á–∏—Å–ª—è–µ—Ç 10% –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–∞—Ä—Ç–Ω—ë—Ä–∞
   ‚Üí –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å Commission
   
4. –ü–∞—Ä—Ç–Ω—ë—Ä –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—ã–≤–æ–¥:
   PayoutService.create_payout_request()
   ‚Üí –ó–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞
   ‚Üí –°–æ–∑–¥–∞—ë—Ç –∑–∞—è–≤–∫—É Payout(status="pending")
   
5. –ê–¥–º–∏–Ω –æ–¥–æ–±—Ä—è–µ—Ç:
   PayoutService.approve_payout()
   ‚Üí –°–ø–∏—Å—ã–≤–∞–µ—Ç —Å –±–∞–ª–∞–Ω—Å–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–∞
   ‚Üí –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "approved"
   ‚Üí –£–≤–µ–¥–æ–º–ª—è–µ—Ç –ø–∞—Ä—Ç–Ω—ë—Ä–∞
```

### –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏

| –¢–∏–ø | –§–æ—Ä–º–∞—Ç | –ü—Ä–∏–º–µ—Ä |
|-----|--------|--------|
| –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | `ref_CODE` | `/start ref_abc123` |
| –ü–∞—Ä—Ç–Ω—ë—Ä | `partner_CODE` | `/start partner_xyz789` |

---

## 7. –°–∏—Å—Ç–µ–º–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞

```python
from core.plugins.base_service import BaseService, ServiceInfo, Response, MenuItem
from core.plugins.core_api import CoreAPI

class MyService(BaseService):
    @property
    def info(self) -> ServiceInfo:
        return ServiceInfo(
            id="my_service",
            name="My Service",
            description="Description",
            version="1.0.0"
        )
    
    async def install(self):
        """–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å–µ—Ä–≤–∏—Å–∞"""
        pass
    
    async def uninstall(self):
        """–£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞"""
        pass
    
    def get_user_menu_items(self, user_id, user_data) -> list[MenuItem]:
        """–ö–Ω–æ–ø–∫–∏ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é"""
        return [
            MenuItem(
                text="üéÆ My Service",
                callback="service:my_service:main",
                order=100
            )
        ]
    
    async def handle_callback(self, user_id, action, params, context):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ callback"""
        api = CoreAPI(self.info.id)
        
        if action == "main":
            return Response(text="Welcome!")
        
        if action == "buy":
            result = await api.deduct_balance(user_id, Decimal("10"))
            if result.success:
                return Response(text="Purchased!")
            return Response(text=f"Error: {result.error}")
    
    async def handle_message(self, user_id, message, context):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞"""
        return Response(text=f"You said: {message.text}")
```

### CoreAPI –º–µ—Ç–æ–¥—ã

```python
api = CoreAPI("service_id")

# –ë–∞–ª–∞–Ω—Å
balance = await api.get_balance(user_id)
await api.add_balance(user_id, amount, source, description)
await api.deduct_balance(user_id, amount, description)

# FSM —Å–æ—Å—Ç–æ—è–Ω–∏–µ
await api.set_user_state(user_id, "state_name", {"key": "value"})
state, data = await api.get_user_state(user_id)
await api.clear_user_state(user_id)

# –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
await api.track_event(user_id, "event_name", {"data": "value"})

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–∏—Å–∞
settings = await api.get_user_service_settings(user_id)

# –ü–æ–¥–ø–∏—Å–∫–∏
has_sub = await api.check_subscription(user_id, "plan_name")
```

### Callback —Ñ–æ—Ä–º–∞—Ç

```
service:{service_id}:{action}:{params}

–ü—Ä–∏–º–µ—Ä—ã:
- service:ai_psychologist:main
- service:ai_psychologist:session:start
- service:ai_psychologist:history:page:2
```

---

## 8. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
Admin Panel
‚îú‚îÄ‚îÄ üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ     ‚îú‚îÄ‚îÄ –û–±—â–∞—è
‚îÇ     ‚îú‚îÄ‚îÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ     ‚îú‚îÄ‚îÄ –§–∏–Ω–∞–Ω—Å—ã
‚îÇ     ‚îú‚îÄ‚îÄ –†–µ—Ñ–µ—Ä–∞–ª—ã
‚îÇ     ‚îî‚îÄ‚îÄ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å
‚îÇ
‚îú‚îÄ‚îÄ üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ     ‚îú‚îÄ‚îÄ –ü–æ–∏—Å–∫
‚îÇ     ‚îú‚îÄ‚îÄ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è
‚îÇ     ‚îú‚îÄ‚îÄ –ë–∞–ª–∞–Ω—Å (–¥–æ–±–∞–≤–∏—Ç—å/—Å–ø–∏—Å–∞—Ç—å)
‚îÇ     ‚îî‚îÄ‚îÄ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ ü§ù –ü–∞—Ä—Ç–Ω—ë—Ä—ã
‚îÇ     ‚îú‚îÄ‚îÄ –°–ø–∏—Å–æ–∫ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤
‚îÇ     ‚îú‚îÄ‚îÄ –ó–∞—è–≤–∫–∏ –Ω–∞ –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ
‚îÇ     ‚îú‚îÄ‚îÄ –ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥
‚îÇ     ‚îî‚îÄ‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–∏—Å—Å–∏–π
‚îÇ
‚îú‚îÄ‚îÄ üõ° –ú–æ–¥–µ—Ä–∞—Ü–∏—è
‚îÇ     ‚îú‚îÄ‚îÄ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
‚îÇ     ‚îú‚îÄ‚îÄ –ë–∞–Ω—ã
‚îÇ     ‚îî‚îÄ‚îÄ –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π
‚îÇ
‚îú‚îÄ‚îÄ üéü –ü—Ä–æ–º–æ–∫–æ–¥—ã
‚îÇ     ‚îú‚îÄ‚îÄ –°–ø–∏—Å–æ–∫
‚îÇ     ‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ
‚îÇ     ‚îú‚îÄ‚îÄ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ     ‚îî‚îÄ‚îÄ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ
‚îú‚îÄ‚îÄ üîå –°–µ—Ä–≤–∏—Å—ã
‚îÇ     ‚îú‚îÄ‚îÄ –°–ø–∏—Å–æ–∫
‚îÇ     ‚îî‚îÄ‚îÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
‚îÇ
‚îú‚îÄ‚îÄ üì¢ –†–∞—Å—Å—ã–ª–∫–∏
‚îÇ     ‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ
‚îÇ     ‚îú‚îÄ‚îÄ –ò—Å—Ç–æ—Ä–∏—è
‚îÇ     ‚îî‚îÄ‚îÄ –¢—Ä–∏–≥–≥–µ—Ä—ã
‚îÇ
‚îú‚îÄ‚îÄ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ     ‚îú‚îÄ‚îÄ –û–±—â–∏–µ
‚îÇ     ‚îú‚îÄ‚îÄ –ü–ª–∞—Ç–µ–∂–∏
‚îÇ     ‚îú‚îÄ‚îÄ –ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞
‚îÇ     ‚îî‚îÄ‚îÄ –ë–æ–Ω—É—Å—ã
‚îÇ
‚îî‚îÄ‚îÄ üåê –Ø–∑—ã–∫–∏
      ‚îî‚îÄ‚îÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏
```

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

```python
# config.py
ADMIN_IDS = [123456789, 987654321]

def is_admin(telegram_id: int) -> bool:
    return telegram_id in ADMIN_IDS
```

---

## 9. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from core.locales import t

# –ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç
text = t(lang, "MAIN_MENU.title")

# –° –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
text = t(lang, "MAIN_MENU.balance", balance="100.50")
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```python
# ru.py
TRANSLATIONS = {
    "MAIN_MENU": {
        "title": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
        "balance": "üí∞ –ë–∞–ª–∞–Ω—Å: {balance} GTON",
        "balance_with_fiat": "üí∞ –ë–∞–ª–∞–Ω—Å: {balance} GTON (~{fiat} ‚ÇΩ)",
        "daily_bonus": "üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å",
        "top_up": "üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å",
        "promocode": "üéü –ü—Ä–æ–º–æ–∫–æ–¥",
        "partner": "üë• –ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞",
        "settings": "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏",
        "help": "‚ùì –ü–æ–º–æ—â—å",
    },
    "SETTINGS": {
        "title": "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏",
        "language": "üåê –Ø–∑—ã–∫",
        "notifications": "üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
    },
    # ...
}
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏

| –ö–æ–¥ | –Ø–∑—ã–∫ | –§–∞–π–ª |
|-----|------|------|
| `ru` | –†—É—Å—Å–∫–∏–π | `ru.py` |
| `en` | English | `en.py` |

---

## 10. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã

```bash
# –¢–µ—Å—Ç —è–¥—Ä–∞ (–ë–î, –º–æ–¥–µ–ª–∏, —Å–µ—Ä–≤–∏—Å—ã)
python tests/test_full_core.py

# –¢–µ—Å—Ç Telegram –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (–º–µ–Ω—é, —Ö–µ–Ω–¥–ª–µ—Ä—ã, —Ä–æ—É—Ç–∏–Ω–≥)
python tests/test_telegram_platform.py

# –ê—É–¥–∏—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —è–¥—Ä–∞ –≤ Telegram
python tests/test_core_integration.py
```

### test_full_core.py (15 —Ç–µ—Å—Ç–æ–≤)

| –¢–µ—Å—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| Models | 19 –º–æ–¥–µ–ª–µ–π –ë–î |
| User creation | –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| GTON balance | –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–∞–Ω—Å–æ–º |
| Referral | –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ |
| Partner | –ü–∞—Ä—Ç–Ω—ë—Ä—ã –∏ frozen balance |
| Payout | –ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥ |
| Promocode | –ü—Ä–æ–º–æ–∫–æ–¥—ã |
| Daily bonus | –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å |
| Settings | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ |
| Commission | –ö–æ–º–∏—Å—Å–∏–∏ |
| Moderation | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –±–∞–Ω—ã |
| Broadcast | –†–∞—Å—Å—ã–ª–∫–∏ |
| Payment constants | –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã |
| CoreAPI | API –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ |
| GTON formatting | –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |

### test_telegram_platform.py (19 —Ç–µ—Å—Ç–æ–≤)

| –¢–µ—Å—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| Handler files | 10 —Ñ–∞–π–ª–æ–≤ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ |
| Handler imports | 12 —Ñ—É–Ω–∫—Ü–∏–π |
| Admin files | 11 —Ñ–∞–π–ª–æ–≤ –∞–¥–º–∏–Ω–∫–∏ |
| Admin imports | 11 –º–æ–¥—É–ª–µ–π |
| Router callbacks | 12 –º–∞—Ä—à—Ä—É—Ç–æ–≤ |
| Main menu buttons | 6 –∫–Ω–æ–ø–æ–∫ |
| Partner functions | 10 —Ñ—É–Ω–∫—Ü–∏–π |
| Admin menu sections | 9 —Å–µ–∫—Ü–∏–π |
| Admin routing | 9 –º–∞—Ä—à—Ä—É—Ç–æ–≤ |
| Localization keys | 21 –∫–ª—é—á |
| Message states | 3 —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM |
| Daily bonus | 3 —ç–ª–µ–º–µ–Ω—Ç–∞ |
| Promocode | 5 —Ñ—É–Ω–∫—Ü–∏–π |
| Settings | 4 —Ñ—É–Ω–∫—Ü–∏–∏ |
| Topup | 5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ |
| Start & Referral | 5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ |
| Utils | 5 —Ñ—É–Ω–∫—Ü–∏–π |
| Callback coverage | 17 callbacks |
| Admin submenus | 15 —Ñ—É–Ω–∫—Ü–∏–π |

---

## 11. –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –°–≤–æ–¥–∫–∞

```
Total features:     66
Fully integrated:   60 (90%)
Partially:          4 (6%)
Not integrated:     2 (3%)
```

### –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ

| –ú–æ–¥—É–ª—å | –§—É–Ω–∫—Ü–∏–∏ |
|--------|---------|
| Users | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø—Ä–æ—Ñ–∏–ª—å, —è–∑—ã–∫, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, —Ä–µ—Ñ–µ—Ä–∞–ª—ã |
| Wallet & Balance | –ü—Ä–æ—Å–º–æ—Ç—Ä, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —Å–ø–∏—Å–∞–Ω–∏–µ, –∏—Å—Ç–æ—Ä–∏—è |
| Partner Program | –†–µ—Ñ–µ—Ä–∞–ª—ã, –∑–∞—è–≤–∫–∏, –∫–∞–±–∏–Ω–µ—Ç, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –∞–¥–º–∏–Ω |
| Payouts | –ó–∞–ø—Ä–æ—Å, –º–µ—Ç–æ–¥—ã, –∏—Å—Ç–æ—Ä–∏—è, –æ–¥–æ–±—Ä–µ–Ω–∏–µ, –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ |
| Referral Commissions | –ê–≤—Ç–æ–∫–æ–º–∏—Å—Å–∏–∏, –∏—Å—Ç–æ—Ä–∏—è |
| Daily Bonus | –ü—Ä–æ—Å–º–æ—Ç—Ä, –ø–æ–ª—É—á–µ–Ω–∏–µ, streak, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| Promocodes | –í–≤–æ–¥, –∞–∫—Ç–∏–≤–∞—Ü–∏—è, —Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| Broadcasts | –°–æ–∑–¥–∞–Ω–∏–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä, –æ—Ç–ø—Ä–∞–≤–∫–∞, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| Triggers | –°–æ–∑–¥–∞–Ω–∏–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| Moderation | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –±–∞–Ω—ã, —Ä–∞–∑–±–∞–Ω—ã, –ª–æ–≥–∏ |
| Settings | –ê–¥–º–∏–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —è–∑—ã–∫ |
| Statistics | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ñ–∏–Ω–∞–Ω—Å—ã, –±–æ–Ω—É—Å—ã, —Ä–µ—Ñ–µ—Ä–∞–ª—ã |
| Services | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –º–µ–Ω—é, callbacks, —Å–æ–æ–±—â–µ–Ω–∏—è |
| Payments | GTON –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è, –∫—É—Ä—Å—ã |
| Notifications | –ê–¥–º–∏–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |

### –ß–∞—Å—Ç–∏—á–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ ‚ö†Ô∏è

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|---------|--------|
| Top up | UI –µ—Å—Ç—å, –ø–ª–∞—Ç–µ–∂–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç |
| User notifications | Placeholder —Å—Ç—Ä–∞–Ω–∏—Ü–∞ |
| Subscriptions | –ú–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞, —Ä–µ–∞–ª–∏–∑—É—é—Ç —Å–µ—Ä–≤–∏—Å—ã |

### –ù–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ ‚ùå

| –§—É–Ω–∫—Ü–∏—è | –ü—Ä–∏—á–∏–Ω–∞ |
|---------|---------|
| Payment providers | TON, YooKassa, CryptoBot ‚Äî –æ—Ç–ª–æ–∂–µ–Ω–æ |
| Payment webhooks | Webhook —Å–µ—Ä–≤–µ—Ä ‚Äî –æ—Ç–ª–æ–∂–µ–Ω–æ |

---

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```bash
# .env
BOT_TOKEN=your_telegram_bot_token
ADMIN_IDS=123456789,987654321
DATABASE_URL=sqlite+aiosqlite:///data/bot.db
DEBUG=false
```

### 3. –ó–∞–ø—É—Å–∫

```bash
python -m core.main
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
python tests/test_full_core.py
python tests/test_telegram_platform.py
```

---

## –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

### TODO

1. **–ü–ª–∞—Ç—ë–∂–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã**
   - [ ] TON Connect
   - [ ] YooKassa
   - [ ] CryptoBot

2. **Webhook —Å–µ—Ä–≤–µ—Ä**
   - [ ] FastAPI/aiohttp —Å–µ—Ä–≤–µ—Ä
   - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

3. **–°–µ—Ä–≤–∏—Å—ã**
   - [ ] AI Psychologist (–ø—Ä–∏–º–µ—Ä)
   - [ ] –î—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã

4. **–£–ª—É—á—à–µ–Ω–∏—è**
   - [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
   - [ ] –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
   - [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–æ–∫

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ –Ω–∞ 05.12.2024*
