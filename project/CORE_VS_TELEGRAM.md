# –Ø–¥—Ä–æ vs Telegram ‚Äî –ê–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## –û–±–∑–æ—Ä —è–¥—Ä–∞

```
core/
‚îú‚îÄ‚îÄ database/models/     # 18 –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ payments/            # –ü–ª–∞—Ç—ë–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
‚îú‚îÄ‚îÄ payout/              # –í—ã–≤–æ–¥—ã –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤
‚îú‚îÄ‚îÄ referral/            # –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏
‚îú‚îÄ‚îÄ plugins/             # API –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ tasks/               # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
‚îî‚îÄ‚îÄ locales/             # –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
```

---

## –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ Telegram

| –ú–æ–¥–µ–ª—å | –§–∞–π–ª | Telegram UI | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|-------------|----------|
| `User` | `user.py` | ‚úÖ | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ |
| `Wallet` | `wallet.py` | ‚úÖ | –ö–æ—à–µ–ª—å–∫–∏ (–±–∞–ª–∞–Ω—Å) |
| `Transaction` | `transaction.py` | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π |
| `Partner` | `partner.py` | ‚úÖ | –ü–∞—Ä—Ç–Ω—ë—Ä—ã |
| `Referral` | `referral.py` | ‚úÖ | –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ |
| `Commission` | `commission.py` | ‚úÖ | –ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–∏—Å—Å–∏–π |
| `Payout` | `payout.py` | ‚úÖ | –ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥ |
| `PromoCode` | `promocode.py` | ‚úÖ | –ü—Ä–æ–º–æ–∫–æ–¥—ã |
| `DailyBonus` | `daily_bonus.py` | ‚úÖ | –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å |
| `Broadcast` | `broadcast.py` | ‚úÖ | –†–∞—Å—Å—ã–ª–∫–∏ |
| `BroadcastTrigger` | `broadcast.py` | ‚úÖ | –¢—Ä–∏–≥–≥–µ—Ä–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ |
| `Setting` | `setting.py` | ‚úÖ | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ |
| `UserWarning` | `moderation.py` | ‚úÖ | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è |
| `UserBan` | `moderation.py` | ‚úÖ | –ë–∞–Ω—ã |
| `Service` | `service.py` | ‚úÖ | –°–µ—Ä–≤–∏—Å—ã |
| `UserService` | `service.py` | ‚úÖ | FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è |

### ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã

| –ú–æ–¥–µ–ª—å | –§–∞–π–ª | –ß—Ç–æ –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ |
|--------|------|----------------------|
| `Payment` | `payment.py` | –ù–µ—Ç UI —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ |
| `PaymentProvider` | `payment.py` | –ù–µ—Ç –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ |
| `Subscription` | `subscription.py` | –ù–µ—Ç UI –ø–æ–¥–ø–∏—Å–æ–∫ |
| `Notification` | `notification.py` | –ù–µ—Ç inbox —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| `NotificationTrigger` | `notification.py` | –ù–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω–∫–µ |
| `UserNotificationSettings` | `notification.py` | –ù–µ—Ç UI –Ω–∞—Å—Ç—Ä–æ–µ–∫ |
| `Event` | `event.py` | –ù–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ –∞–¥–º–∏–Ω–∫–µ |
| `ExchangeRate` | `exchange_rate.py` | –¢–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞ |

---

## –°–µ—Ä–≤–∏—Å—ã —è–¥—Ä–∞

### PaymentService (`core/payments/service.py`)

| –ú–µ—Ç–æ–¥ | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------------|----------|
| `get_balance()` | ‚úÖ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ |
| `get_balance_with_fiat()` | ‚úÖ | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| `add_gton()` | ‚úÖ | –ë–æ–Ω—É—Å—ã, –ø—Ä–æ–º–æ–∫–æ–¥—ã |
| `deduct_gton()` | ‚úÖ | –ß–µ—Ä–µ–∑ CoreAPI |
| `create_payment()` | ‚ùå | **–ù–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω** |
| `confirm_payment()` | ‚ùå | **–ù–µ—Ç webhook** |
| `get_payment()` | ‚ùå | –ù–µ—Ç UI |
| `get_user_payments()` | ‚ùå | –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ |
| `expire_pending_payments()` | ‚ùå | –ù–µ—Ç —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ |

### PayoutService (`core/payout/service.py`)

| –ú–µ—Ç–æ–¥ | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------------|----------|
| `create_payout_request()` | ‚úÖ | –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–π –∫–∞–±–∏–Ω–µ—Ç |
| `approve_payout()` | ‚úÖ | –ê–¥–º–∏–Ω–∫–∞ |
| `reject_payout()` | ‚úÖ | –ê–¥–º–∏–Ω–∫–∞ |
| `cancel_payout()` | ‚úÖ | –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–π –∫–∞–±–∏–Ω–µ—Ç |
| `get_partner_payouts()` | ‚úÖ | –ò—Å—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–æ–≤ |

### ReferralCommissionService (`core/referral/commission.py`)

| –ú–µ—Ç–æ–¥ | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------------|----------|
| `process_commission()` | ‚úÖ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ deduct |
| `get_commission_settings()` | ‚úÖ | –ò–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ |

### RatesManager (`core/payments/rates.py`)

| –ú–µ—Ç–æ–¥ | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------------|----------|
| `get_rate()` | ‚úÖ | –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è |
| `update_all_rates()` | ‚úÖ | –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ |
| `get_gton_rates()` | ‚úÖ | –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞ |

### CurrencyConverter (`core/payments/converter.py`)

| –ú–µ—Ç–æ–¥ | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------------|----------|
| `convert_to_gton()` | ‚úÖ | –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ |
| `convert_from_gton()` | ‚úÖ | –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ ‚ÇΩ |
| `get_gton_rates()` | ‚úÖ | –ö—É—Ä—Å—ã |

---

## CoreAPI –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ (`core/plugins/core_api.py`)

### ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `get_user()` | –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `get_user_by_id()` | –ü–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É ID |
| `get_user_language()` | –Ø–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `get_text()` | –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç |
| `get_balance()` | –ë–∞–ª–∞–Ω—Å GTON |
| `deduct_balance()` | –°–ø–∏—Å–∞—Ç—å GTON (+ –∫–æ–º–∏—Å—Å–∏—è) |
| `add_balance()` | –ù–∞—á–∏—Å–ª–∏—Ç—å GTON |
| `set_user_state()` | FSM —Å–æ—Å—Ç–æ—è–Ω–∏–µ |
| `get_user_state()` | –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ |
| `clear_user_state()` | –û—á–∏—Å—Ç–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ |
| `check_subscription()` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É |
| `get_user_service_data()` | –î–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å–∞ |
| `get_user_service_settings()` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ |
| `set_user_service_settings()` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| `track_event()` | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ |

---

## –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (`core/tasks/`)

| –ó–∞–¥–∞—á–∞ | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|--------|----------|
| `update_rates` | `rates.py` | ‚úÖ | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ |
| `process_triggers` | `triggers.py` | ‚úÖ | –¢—Ä–∏–≥–≥–µ—Ä–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ |
| `check_expired_bans` | `moderation.py` | ‚úÖ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–±–∞–Ω |
| `expire_pending_payments` | ‚Äî | ‚ùå | **–ù–µ –∑–∞–ø—É—â–µ–Ω–∞** |

---

## –ß—Ç–æ –ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ Telegram

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)

| –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª | –ß—Ç–æ –Ω—É–∂–Ω–æ |
|------------|-----------|
| **–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞** | UI –≤—ã–±–æ—Ä–∞ —Å—É–º–º—ã ‚Üí –≤—ã–∑–æ–≤ `PaymentService.create_payment()` |
| **Webhook –ø–ª–∞—Ç–µ–∂–µ–π** | Endpoint –¥–ª—è `confirm_payment()` |
| **–í—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞** | UI —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏–∑ `PaymentProvider` |

### üü° –í–∞–∂–Ω–æ (—É–ª—É—á—à–∏—Ç UX)

| –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª | –ß—Ç–æ –Ω—É–∂–Ω–æ |
|------------|-----------|
| **–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** | UI —Å–ø–∏—Å–∫–∞ –∏–∑ `Transaction` |
| **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω—ë—Ä—É** | –ü—Ä–∏ –Ω–æ–≤–æ–º —Ä–µ—Ñ–µ—Ä–∞–ª–µ, –ø—Ä–∏ –∫–æ–º–∏—Å—Å–∏–∏ |
| **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** | UI –¥–ª—è `UserNotificationSettings` |
| **Inbox —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** | UI –¥–ª—è `Notification` |

### üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ

| –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª | –ß—Ç–æ –Ω—É–∂–Ω–æ |
|------------|-----------|
| **–ü–æ–¥–ø–∏—Å–∫–∏** | UI –¥–ª—è `Subscription` |
| **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ** | –ì—Ä–∞—Ñ–∏–∫–∏ –∏–∑ `Event` |
| **–¢—Ä–∏–≥–≥–µ—Ä—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ `NotificationTrigger` |

---

## –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º

### 1. –ü–ª–∞—Ç–µ–∂–∏

**–Ø–¥—Ä–æ –≥–æ—Ç–æ–≤–æ:**
```python
# PaymentService
create_payment(user_id, amount_gton, provider, currency) ‚Üí PaymentResult
confirm_payment(payment_uuid, provider_payment_id, provider_data) ‚Üí bool
get_payment(payment_uuid) ‚Üí PaymentInfo
get_user_payments(user_id, status, limit) ‚Üí List[PaymentInfo]
expire_pending_payments() ‚Üí int

# –ú–æ–¥–µ–ª–∏
Payment ‚Äî –∑–∞–ø–∏—Å—å –ø–ª–∞—Ç–µ–∂–∞
PaymentProvider ‚Äî –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (ton, cryptobot, yookassa)
```

**Telegram –ù–ï –≥–æ—Ç–æ–≤:**
- –ù–µ—Ç UI –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –ù–µ—Ç –≤—ã–∑–æ–≤–∞ `create_payment()`
- –ù–µ—Ç webhook –¥–ª—è `confirm_payment()`
- –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
1. –•–µ–Ω–¥–ª–µ—Ä `topup.py` ‚Üí –≤—ã–∑–æ–≤ `create_payment()`
2. Webhook endpoint –≤ `bot.py`
3. UI –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π

### 2. –ü–æ–¥–ø–∏—Å–∫–∏

**–Ø–¥—Ä–æ –≥–æ—Ç–æ–≤–æ:**
```python
# –ú–æ–¥–µ–ª—å Subscription
- user_id, service_id, plan
- started_at, expires_at
- price, transaction_id
- status, auto_renew
- is_active, days_left

# CoreAPI
check_subscription(user_id) ‚Üí SubscriptionDTO
```

**Telegram –ù–ï –≥–æ—Ç–æ–≤:**
- –ù–µ—Ç UI –ø–æ–∫—É–ø–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
- –ù–µ—Ç UI —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–æ–π
- –ù–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏

### 3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–Ø–¥—Ä–æ –≥–æ—Ç–æ–≤–æ:**
```python
# –ú–æ–¥–µ–ª–∏
Notification ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
NotificationTrigger ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã
UserNotificationSettings ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

# –¢—Ä–∏–≥–≥–µ—Ä—ã
- low_balance
- subscription_expiring
- subscription_expired
- inactive
- welcome
- after_deposit
```

**Telegram –ù–ï –≥–æ—Ç–æ–≤:**
- –ù–µ—Ç inbox —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ù–µ—Ç UI –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –¢—Ä–∏–≥–≥–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ BroadcastTrigger

### 4. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

**–Ø–¥—Ä–æ –≥–æ—Ç–æ–≤–æ:**
```python
# –ú–æ–¥–µ–ª—å Event
- user_id, category, action
- service_id, label, value
- properties, session_id
- platform, created_at

# CoreAPI
track_event(user_id, category, action, label, value, properties)
```

**Telegram –ù–ï –≥–æ—Ç–æ–≤:**
- –ù–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –∞–¥–º–∏–Ω–∫–µ
- –ù–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

---

## –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ü–ª–∞—Ç–µ–∂–∏ (–∫—Ä–∏—Ç–∏—á–Ω–æ)

1. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –≤ –ë–î**
   ```python
   PaymentProvider(id="yookassa", name="–ÆKassa", currencies=["RUB"])
   PaymentProvider(id="cryptobot", name="CryptoBot", currencies=["TON", "USDT"])
   ```

2. **UI –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞** (`topup.py`)
   ```
   üí≥ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
   ‚îú‚îÄ‚îÄ –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:
   ‚îú‚îÄ‚îÄ [üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞ (–ÆKassa)]
   ‚îú‚îÄ‚îÄ [ü™ô –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ (CryptoBot)]
   ‚îî‚îÄ‚îÄ [‚Üê –ù–∞–∑–∞–¥]
   ```

3. **–í—ã–∑–æ–≤ create_payment()**
   ```python
   result = await payment_service.create_payment(
       user_id=user_id,
       amount_gton=amount,
       provider="yookassa",
       currency="RUB"
   )
   # –û—Ç–ø—Ä–∞–≤–∏—Ç—å payment_url –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   ```

4. **Webhook** (`bot.py` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π endpoint)
   ```python
   @app.post("/webhook/payment/{provider}")
   async def payment_webhook(provider: str, data: dict):
       await payment_service.confirm_payment(
           payment_uuid=data["payment_uuid"],
           provider_payment_id=data["id"],
           provider_data=data
       )
   ```

### –§–∞–∑–∞ 2: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω—ë—Ä–∞–º

1. **–ü—Ä–∏ –Ω–æ–≤–æ–º —Ä–µ—Ñ–µ—Ä–∞–ª–µ** (`start.py`)
   ```python
   # –í process_referral() –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è Referral
   await notify_referrer(referrer_id, referred_user)
   ```

2. **–ü—Ä–∏ –∫–æ–º–∏—Å—Å–∏–∏** (`commission.py`)
   ```python
   # –í process_commission() –ø–æ—Å–ª–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
   await notify_commission(referrer_id, amount, referred_user)
   ```

### –§–∞–∑–∞ 3: –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

1. **UI –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é**
   ```
   [üìú –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π]
   ```

2. **–•–µ–Ω–¥–ª–µ—Ä** (`handlers/history.py`)
   ```python
   async def history_callback(update, context):
       transactions = await get_user_transactions(user_id, limit=20)
       # –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫
   ```

---

## –†–µ–∑—é–º–µ

### –Ø–¥—Ä–æ: 95% –≥–æ—Ç–æ–≤–æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å |
|-----------|------------|
| –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö | ‚úÖ 100% |
| PaymentService | ‚úÖ 100% |
| PayoutService | ‚úÖ 100% |
| ReferralCommissionService | ‚úÖ 100% |
| CoreAPI | ‚úÖ 100% |
| –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ | ‚ö†Ô∏è 80% |

### Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: 70% –≥–æ—Ç–æ–≤–æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å | –ë–ª–æ–∫–µ—Ä |
|-----------|------------|--------|
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | ‚úÖ 100% | ‚Äî |
| –ë–∞–ª–∞–Ω—Å | ‚úÖ 100% | ‚Äî |
| –ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞ | ‚úÖ 95% | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| –ü—Ä–æ–º–æ–∫–æ–¥—ã | ‚úÖ 100% | ‚Äî |
| –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å | ‚úÖ 100% | ‚Äî |
| –ú–æ–¥–µ—Ä–∞—Ü–∏—è | ‚úÖ 100% | ‚Äî |
| –†–∞—Å—Å—ã–ª–∫–∏ | ‚úÖ 100% | ‚Äî |
| **–ü–ª–∞—Ç–µ–∂–∏** | ‚ùå 10% | **–ö—Ä–∏—Ç–∏—á–Ω–æ** |
| –ü–æ–¥–ø–∏—Å–∫–∏ | ‚ùå 0% | ‚Äî |
| –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | ‚ö†Ô∏è 30% | ‚Äî |
| –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ | ‚ö†Ô∏è 20% | ‚Äî |

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å

```
1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π (PaymentService ‚Üí Telegram)
   ‚Üì
2. Webhook –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
   ‚Üì
3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω—ë—Ä–∞–º
   ‚Üì
4. –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
```

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 10.12.2024*
