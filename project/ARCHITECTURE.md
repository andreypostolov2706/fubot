# ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° FuBot

## ĞĞ±Ñ‰Ğ°Ñ ÑÑ…ĞµĞ¼Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FuBot Core                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   ĞĞ´Ğ¼Ğ¸Ğ½ĞºĞ°    â”‚  â”‚  ĞŸĞ°Ñ€Ñ‚Ğ½Ñ‘Ñ€ĞºĞ°   â”‚  â”‚   ĞŸĞ»Ğ°Ñ‚ĞµĞ¶Ğ¸ / Ğ’Ñ‹Ğ²Ğ¾Ğ´     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“ core.db: users, wallets, transactions, partners, etc.       â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“± Platform Adapters: Telegram (+ Discord, WhatsApp)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
                    Service Interface (CoreAPI)
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Service: AI Psychologist                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°: ÑĞµÑÑĞ¸Ğ¸, ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ, Ğ˜Ğ˜, Ğ³Ğ¾Ğ»Ğ¾Ñ                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ğŸ“ service.db: chat_sessions, messages, summaries              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² ÑĞ´Ñ€Ğ°

```
core/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ main.py                     # Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°
â”œâ”€â”€ config.py                   # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â”‚
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ connection.py           # ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ‘Ğ”
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user.py             # User
â”‚   â”‚   â”œâ”€â”€ wallet.py           # Wallet
â”‚   â”‚   â”œâ”€â”€ transaction.py      # Transaction
â”‚   â”‚   â”œâ”€â”€ partner.py          # Partner, Referral
â”‚   â”‚   â”œâ”€â”€ payout.py           # Payout
â”‚   â”‚   â”œâ”€â”€ service.py          # Service, UserService
â”‚   â”‚   â”œâ”€â”€ subscription.py     # Subscription
â”‚   â”‚   â”œâ”€â”€ analytics.py        # Event
â”‚   â”‚   â”œâ”€â”€ broadcast.py        # Broadcast
â”‚   â”‚   â””â”€â”€ setting.py          # Setting
â”‚   â””â”€â”€ repositories/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ user_repo.py
â”‚       â”œâ”€â”€ wallet_repo.py
â”‚       â”œâ”€â”€ partner_repo.py
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ locales/                    # ğŸŒ Ğ›Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
â”‚   â”œâ”€â”€ __init__.py             # Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ñ‡Ğ¸Ğº
â”‚   â”œâ”€â”€ ru.py                   # Ğ ÑƒÑÑĞºĞ¸Ğ¹ (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹)
â”‚   â”œâ”€â”€ en.py                   # ĞĞ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹
â”‚   â””â”€â”€ de.py                   # ĞĞµĞ¼ĞµÑ†ĞºĞ¸Ğ¹
â”‚
â”œâ”€â”€ services/                   # Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ÑĞ´Ñ€Ğ°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ user_service.py
â”‚   â”œâ”€â”€ wallet_service.py
â”‚   â”œâ”€â”€ partner_service.py
â”‚   â”œâ”€â”€ payment_service.py
â”‚   â”œâ”€â”€ analytics_service.py
â”‚   â””â”€â”€ broadcast_service.py
â”‚
â”œâ”€â”€ admin/                      # ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ handlers.py
â”‚   â”œâ”€â”€ keyboards.py
â”‚   â””â”€â”€ views/
â”‚       â”œâ”€â”€ users.py
â”‚       â”œâ”€â”€ partners.py
â”‚       â”œâ”€â”€ payouts.py
â”‚       â”œâ”€â”€ services.py
â”‚       â”œâ”€â”€ broadcasts.py
â”‚       â”œâ”€â”€ languages.py        # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ·Ñ‹ĞºĞ°Ğ¼Ğ¸
â”‚       â””â”€â”€ settings.py
â”‚
â”œâ”€â”€ platform/                   # ĞĞ±ÑÑ‚Ñ€Ğ°ĞºÑ†Ğ¸Ñ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py                 # BasePlatform
â”‚   â””â”€â”€ telegram/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ bot.py
â”‚       â”œâ”€â”€ handlers.py
â”‚       â””â”€â”€ keyboards.py
â”‚
â”œâ”€â”€ plugins/                    # ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_service.py         # BaseService
â”‚   â”œâ”€â”€ core_api.py             # CoreAPI
â”‚   â”œâ”€â”€ registry.py             # ServiceRegistry
â”‚   â”œâ”€â”€ loader.py               # ServiceLoader
â”‚   â””â”€â”€ installer.py            # CLI Ğ´Ğ»Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸
â”‚
â””â”€â”€ utils/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ helpers.py
    â””â”€â”€ validators.py
```

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ÑĞµÑ€Ğ²Ğ¸ÑĞ°

```
services/
â””â”€â”€ ai_psychologist/            # ğŸ“¦ Ğ¡ĞµÑ€Ğ²Ğ¸Ñ
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ service.py              # Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ (Ğ½Ğ°ÑĞ»ĞµĞ´ÑƒĞµÑ‚ BaseService)
    â”œâ”€â”€ config.py               # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ°
    â”‚
    â”œâ”€â”€ database/               # Ğ¡Ğ²Ğ¾Ñ Ğ‘Ğ” (service.db)
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ connection.py
    â”‚   â””â”€â”€ models.py           # ChatSession, Message, Summary
    â”‚
    â”œâ”€â”€ handlers/               # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ session.py          # Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° ÑĞµÑÑĞ¸Ğ¹
    â”‚   â””â”€â”€ settings.py         # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ³Ğ¾Ğ»Ğ¾ÑĞ°
    â”‚
    â”œâ”€â”€ ai/                     # Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ OpenAI
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ client.py
    â”‚
    â”œâ”€â”€ keyboards.py            # ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ ÑĞµÑ€Ğ²Ğ¸ÑĞ°
    â”œâ”€â”€ messages.py             # Ğ¢ĞµĞºÑÑ‚Ñ‹
    â”‚
    â”œâ”€â”€ install.bat             # ğŸ”§ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ñ‰Ğ¸Ğº (Windows)
    â”œâ”€â”€ install.sh              # ğŸ”§ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ñ‰Ğ¸Ğº (Linux)
    â”œâ”€â”€ requirements.txt        # Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ°
    â””â”€â”€ README.md
```

## ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### 1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ /start

```
Telegram â†’ core/platform/telegram/handlers.py
         â†’ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ÑÑ User Ğ² core.db
         â†’ Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ÑÑ‚ÑÑ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹
         â†’ Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ¼ĞµĞ½Ñ (Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğµ + Ğ¾Ñ‚ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²)
         â†’ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
```

### 2. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ ÑĞµÑ€Ğ²Ğ¸ÑĞ°

```
Callback: "service:ai_psychologist:main"
         â†’ core/platform/telegram/handlers.py
         â†’ ServiceRegistry.get("ai_psychologist")
         â†’ service.handle_callback(user_id, "main", params, context)
         â†’ Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Response
         â†’ Ğ¯Ğ´Ñ€Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
```

### 3. Ğ¡ĞµÑ€Ğ²Ğ¸Ñ ÑĞ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹

```
service.py:
    result = await self.core.deduct_balance(
        user_id=123,
        amount=10,
        reason="ai_message"
    )
    
core/services/wallet_service.py:
    â†’ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ
    â†’ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Transaction
    â†’ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Wallet
    â†’ ĞĞ°Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ñ Ñ€ĞµÑ„ĞµÑ€ĞµÑ€Ñƒ (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)
    â†’ Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
```

## Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | ĞÑ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ·Ğ° |
|-----------|-------------|
| **Core** | ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸, Ğ±Ğ°Ğ»Ğ°Ğ½Ñ, Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ¸, Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€ĞºĞ°, Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° |
| **Service** | Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°, ÑĞ²Ğ¾Ñ Ğ‘Ğ”, ÑĞ²Ğ¾Ğ¸ Ñ…ĞµĞ½Ğ´Ğ»ĞµÑ€Ñ‹ |
| **Platform** | ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ°/Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹, ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ |

## ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹

1. **Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾ Telegram** â€” Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ‡ĞµÑ€ĞµĞ· CoreAPI
2. **Ğ¯Ğ´Ñ€Ğ¾ Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ ÑĞµÑ€Ğ²Ğ¸ÑĞ°** â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ BaseService
3. **ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ â€” ÑĞ²Ğ¾Ñ Ğ‘Ğ”** â€” Ğ½ĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ² Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
4. **Ğ•Ğ´Ğ¸Ğ½Ğ°Ñ Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°** â€” core/main.py Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ²ÑÑ‘
